<!doctype html><html lang="en"><head><title>Allowed Cloud</title><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel="stylesheet" href="/style.css?v=1616601725206"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/assets/animate.min.css"><link rel="stylesheet" href="/assets/hover.css"><link rel="stylesheet" href="/prism-material-light.css"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet"><script src="/js/alpine.js?v=1616601725206"></script></head><body class="flex flex-col h-screen"><nav><div class="nav flex flex-row flex-nowrap items-center justify-end mr-4"><a href="/posts">Posts</a> <a href="/about">About</a> <a href="/" title="Home" class="bg-purple-200 p-1 rounded-br-md rounded-bl-md"><img src="images/home.svg" alt="Home icon"></a></div></nav><div class="flex-grow"><div id="content" class="grid"><article class="grid place-content-center text-lg p-4 md:p-16 z-20 pb-12 mb-48 bg-white"><h1 class="post-title text-2xl md:text-3xl">GitHub Pages custom domain with Eleventy</h1><div class="grid grid-cols"><div class="flex flex-row items-center"><div class="text-gray-300 mr-2"><img src="/images/calendar.svg" alt="Calendar icon"></div><time datetime="2021-03-24T16:02:05.203Z" class="text-gray-400 text-sm pt-1">March 23, 2021</time></div><div class="flex mt-3"><a href="/tags/general" class="tags">general </a><a href="/tags/web development" class="tags">web development </a><a href="/tags/github" class="tags">github</a></div></div><div class="post-text max-w-prose text-gray-800 md:text-xl"><p>How to configure a custom domain when deploying a website created with Eleventy to GitHub Pages</p><p>I wanted to document a problem that arises when deploying a website to <a href="https://pages.github.com/">GitHub Pages</a> that uses a custom domain. This isn't something unique to the <a href="https://11ty.dev">Eleventy</a> static site generator, and it's not necessarily a <em>problem</em> per se, just how things work. But it can cause some headaches initially when trying to figure out why your custom domain works and then doesn't work.</p><h2>GitHub Pages</h2><p>GitHub allows you to host a single website that by default is located at a subdomain of <code>github.io</code>. The name for the subdomain is your GitHub username. For example in my case, I have the username allowedcloud so my GitHub Pages subdomain will be <code>allowedcloud.github.io</code>. They also allow you to use your own domain name, which GitHub calls a custom domain. The settings for the custom domain can be configured in the repository's Settings page. When you set the custom domain through the GitHub web interface Settings page what happens is that GitHub automatically creates a file for you detailing that domain name and commits it to your repository. The file it creates is called CNAME, and it simply contains a single line with your custom domain name. Since my custom domain is <code>allowed.cloud</code>, my CNAME contains <code>allowed.cloud</code> in it.</p><h3>Problem</h3><p>When using GitHub Pages and deploying your website with actions, the website is not being served from your main branch. Instead, when the action runs it drops all the output into a different branch. So when you update the custom domain through the web interface and the CNAME file is created, it is only added to this other branch that your website is being served from. Since your main branch does not contain the CNAME file, when you do a fresh deploy the file is not found in output. Which causes your custom domain settings to get wiped and your custom domain to no longer work.</p><h3>Solution</h3><p>I wouldn't even bother with the GitHub web interface because you can just create the CNAME file yourself in your local repository. This allows you to make sure that when Eleventy does a build on a fresh push, your CNAME file is carried over into the branch that your website is being served from.</p><h2>From the top</h2><p>Now that I've given a bit of context, let's start from scratch to explain the whole process. There are essentially two steps, the first being to configure your DNS settings to point to GitHub IP address, the second being the creation of the CNAME file. My domain is registered on NameCheap but the DNS is being managed by CloudFlare. For the DNS settings of your domain, you need to add four A Records each with a different IP address. At the time of writing this, the IP addresses were:</p><pre class="language-text"><code class="language-text">185.199.110.153
185.199.111.153
185.199.112.153
185.199.113.153</code></pre><p>For CloudFlare, I create a record <strong>type</strong> of A, the record <strong>name</strong> as allowed.cloud and the record <strong>content</strong> as one of the four IP addresses.</p><img src="/images/allowed-cloud-cloudflare-dns-settings.png" alt="DNS settings for Allowed Cloud on CloudFlare"><p>Cool. That takes care of the first step, let's deal with the CNAME file. In your local repository create a file called CNAME, with no file extension. In it type in your custom domain on line 1 and save it. Now hop over to your Eleventy config file, mine is called .eleventy.js. We are going to use the addPassthroughCopy method to make sure that our CNAME file is carried over to the output directory when a build takes place.</p><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eleventyConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
eleventyConfig<span class="token punctuation">.</span><span class="token function">addPassthroughCopy</span><span class="token punctuation">(</span><span class="token string">"CNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>You should be ready to rock! Now whenever you do a new push, and it triggers a build, the CNAME file won't get wiped every time you do a build.</p><p>This is a test.</p></div></article><footer class="post-footer h-52 bottom-0 z-0 py-4 bg-gray-50 shadow-inner"><div class="grid grid-cols-4 h-40 place-items-center"><div></div><div class="grid grid-row text-gray-400 text-xl underline"><a href="/" title="Home">Home</a> <a href="/posts" title="Posts">Posts</a> <a href="/about" title="About">About</a></div><div class="flex"><a href="https://github.com/allowedcloud" title="Github" target="_blank" class="px-1"><img src="/images/github.svg" alt="Github"> </a><a href="https://twitter.com/allowedcloud" title="Twitter" target="_blank" class="px-1"><img src="/images/twitter.svg" alt="Twitter"> </a><a href="https://linkedin.com/" title="LinkedIn" target="_blank" class="px-1"><img src="/images/linkedin.svg" alt="LinkedIn"> </a><a href="mailto:allowedcloud@gmail.com" title="Email" class="px-1"><img src="/images/mail.svg" alt="Email"></a></div><div></div></div></footer></div><div class="fixed bottom-2 w-full text-center text-gray-300"><p class="text-sm">Allowed Cloud Â· 2021</p></div><div class="progress-container fixed bottom-0 z-50"><div class="progress-bar" id="myBar"></div></div></div><footer class="flex flex-col place-items-center justify-center m-1"><div class="flex flex-nowrap place-content-center p-2"><a href="https://github.com/allowedcloud" title="Github" target="_blank" class="px-2"><img src="/images/github.svg" alt="Github"> </a><a href="https://twitter.com/allowedcloud" title="Twitter" target="_blank" class="px-2"><img src="/images/twitter.svg" alt="Twitter"> </a><a href="https://linkedin.com/" title="LinkedIn" target="_blank" class="px-2"><img src="/images/linkedin.svg" alt="LinkedIn"> </a><a href="mailto:allowedcloud@gmail.com" title="Email" class="px-2"><img src="/images/mail.svg" alt="Email"></a></div></footer></body></html>